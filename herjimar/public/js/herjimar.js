!function(){"use strict";$(document).on("app_ready",function(){var e=[],o=frappe.get_route();if(o.length>=3&&"List"==o[0]&&"List"==o[2]){var r=o[1];console.log("pidiendo menus de "+r),frappe.db.get_list("Formatos de Exportacion",{fields:["name","nombre"],filters:{modelo:r,activo:1,modo:"Lista"}}).then(function(o){console.log("ha vuelto "+r),e=o,frappe.listview_settings[r]={onload:function(o){e.forEach(function(e){e.nombre;var r=e.name;o.page.add_menu_item(e.nombre,function(e){var o=$(frappe.pages[frappe.get_route().join("/")]).find("input:checked");if(0!=o.length){var a=[];o.each(function(e,o){var r=unescape($(o).attr("data-name"));a.push(r)}),console.log(a),frappe.call({method:"herjimar.herjimar.exportacion.exportarlista",callback:function(e){"ERROR"!=e.message&&(window.location.href="https://erp.herjimar.com/files/"+e.message)},args:{plantilla:r,objetos:a},btn:$(".primary-action"),freeze:!0,error:function(e){console.log("Error:"+e.message)}})}else frappe.throw("Debe elegir los registros a exportar")})})}}})}frappe.db.get_list("Formatos de Exportacion",{fields:["name","modelo"],filters:{activo:1}}).then(function(e){for(var o=0;o<e.length;o++)console.log("he leido "+e[o].modelo)}),frappe.db.get_list("Formatos de Exportacion",{fields:["name","modelo"],filters:{activo:1}}).then(function(e){for(var o=0;o<e.length;o++)frappe.ui.form.on(e[o].modelo,{refresh:function(e){frappe.db.get_list("Formatos de Exportacion",{fields:["name"],filters:{activo:1,modo:"Registro",modelo:e.doctype}}).then(function(o){for(var r=0;r<o.length;r++){var a=e.docname;e.page.add_menu_item(o[r].name,function(e){console.log("voy a llamar"),frappe.call({method:"herjimar.herjimar.exportacion.exportar",callback:function(e){console.log("he vuelto de frape call"),console.log(e),"ERROR"!=e.message&&(window.location.href="https://erp.herjimar.com/files/"+e.message)},args:{plantilla:e.currentTarget.innerText,objeto:a},btn:$(".primary-action"),freeze:!0,error:function(e){console.log("Error:"+e.message)}})})}})}})})})}();
//# sourceMappingURL=herjimar.js.map
