!function(){"use strict";!function(){console.log("herjimar_timsheet_list");var e=document.createElement("link");e.rel="stylesheet",e.href="data:text/css,"+escape("@import url('https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css');"),document.getElementsByTagName("head")[0].appendChild(e),$.getScript("https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js",function(){console.log("select2 cargado")}),$.getScript("https://shanegh.github.io/analogue-time-picker/demo/analogue-time-picker.js",function(e,t,o){});var t=document.createElement("style");function o(){var e=new frappe.ui.Dialog({title:"Nuevo Parte",fields:[{label:"Fecha",fieldname:"fecha",fieldtype:"Date",reqd:1,onchange:function(t){null!=this.value&&0!=this.value.length?frappe.call({method:"GET",method:"herjimar.herjimar.timesheet.getreportado",args:{fecha:this.value},freeze:!0,callback:function(t){e.fields_dict.reportado.$wrapper.html("<B>"+t.message+"</B>")}}):e.fields_dict.reportado.$wrapper.html("")}},{label:"Reportado",fieldname:"reportado",fieldtype:"HTML"},{label:"Desde",fieldname:"desde",fieldtype:"HTML"},{label:"",fieldname:"tiempo",fieldtype:"HTML"},{fieldtype:"HTML",fieldname:"data_button"},{label:"Incidencia",fieldname:"incidencia",fieldtype:"HTML"},{label:"Hoja Verde",fieldname:"hv",id:"hvid",fieldtype:"HTML"},{label:"Actividad",fieldname:"actividad",fieldtype:"Link",options:"Activity Type",reqd:1},{label:"Reclamable",fieldname:"reclamable",fieldtype:"Check",onchange:function(t){e.fields_dict.reclamable.last_value?(e.fields_dict.incidencia.$wrapper.show(),e.fields_dict.data_button.$wrapper.hide()):(e.fields_dict.incidencia.$wrapper.hide(),e.fields_dict.data_button.$wrapper.show())}},{label:"Terminado",fieldname:"terminado",fieldtype:"Check"},{label:"Descripcion",fieldname:"descripcion",fieldtype:"Data"}],primary_action_label:"Guardar",primary_action:function(t){var o=0,i=document.getElementById("desdeh").value,n=document.getElementById("desdem").value,a=document.getElementById("hastah").value,l=document.getElementById("hastam").value,p=new Date(0,0,0,i,n,0);if((o=(new Date(0,0,0,a,l,0).getTime()-p.getTime())/1e3/60/60).toFixed(2)<0&&(o+=24),0==t.reclamable){if(null==$("#rec_id12").select2("val"))return void msgprint("Debe seleccionar al menos una ODF")}else if(null==$("#rec_id13").select2("val"))return void msgprint("Debe seleccionar al menos una incidencia");frappe.call({method:"GET",method:"herjimar.herjimar.timesheet.nuevoparte",args:{values:t,horas:o,odfs:$("#rec_id12").select2("val"),incidencias:$("#rec_id13").select2("val"),desde:document.getElementById("desdeh").value+":"+document.getElementById("desdem").value,hasta:document.getElementById("hastah").value+":"+document.getElementById("hastam").value},freeze:!0,callback:function(o){console.log(o);var i=new Date(t.fecha);frappe.confirm("Ya ha reportado "+o.message.horas+" horas para la fecha "+i.toLocaleDateString()+".¿Desea añadir mas partes?",function(){e.clear(),e.fields_dict.tiempo.$wrapper.html(""),e.fields_dict.hv.$wrapper.html(""),e.fields_dict.fecha.set_value(t.fecha),e.fields_dict.fecha.refresh(),document.getElementById("desdeh").value=document.getElementById("hastah").value,document.getElementById("desdem").value=document.getElementById("hastam").value,document.getElementById("hastah").value="0",document.getElementById("hastam").value="0",$("#rec_id12").val(null).trigger("change"),e.fields_dict.fecha.refresh()},function(){msgprint("Confirme el parte para continuar","Partes"),frappe.set_route("Form","Timesheet",o.message.parte)})}})}});e.fields_dict.incidencia.$wrapper.hide(),e.fields_dict.desde.$wrapper.html('\n    <div class="form-group"><div class="clearfix"><label class="control-label" style="padding-right: 0px;">Desde/Hasta</label></div>\n    <div class="control-input-wrapper">\t\t\t\t\t\t\n        <div class="control-input" style="display: block;">\n        \x3c!--<input type="text" name="desde" class="time mdl-textfield__input" id="desde" style="width: 48%; align: left;"/>--\x3e<select id="desdeh" ><option selected="selected" value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>:<select id="desdem"><option selected="selected" value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select>\t\t\t----\x3e\x3c!--<input type="text" name="hasta" class="time mdl-textfield__input" id="hasta" style="width: 48%; align: right;"/>--\x3e<select id="hastah" onchange="actualizahoras()"><option selected="selected">00</option><option>01</option><option>02</option><option>03</option><option>04</option><option>05</option><option>06</option><option>07</option><option>08</option><option>09</option><option>10</option><option>11</option><option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>17</option><option>18</option><option>19</option><option>20</option><option>21</option><option>22</option><option>23</option></select>:<select id="hastam" onchange="actualizahoras()"><option selected="selected" value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select>\n        </div>\t\t\t\t\t\t\n        <div class="control-value like-disabled-input bold" style="display: none;"></div>\t\n        <p class="help-box small text-muted hidden-xs"></p>\t\n    </div></div>'),e.$wrapper.on("focus",function(){setTimeout(function(){var t=document.getElementById("desdeh").value,o=document.getElementById("desdem").value,i=document.getElementById("hastah").value,n=document.getElementById("hastam").value,a=new Date(0,0,0,t,o,0),l=(new Date(0,0,0,i,n,0).getTime()-a.getTime())/1e3/60/60;l.toFixed(2)<0&&(l+=24),e.fields_dict.tiempo.$wrapper.html("<B>"+l.toFixed(2)+" hora(s)</B>")},500)}),$("#rec_id12").remove(),$("#rec_id13").remove(),e.fields_dict.incidencia.$wrapper.html('Incidencias<select id=rec_id13 class="select2-container input-large form-control select2me" multiple=multiple style=width:100%> '),e.fields_dict.data_button.$wrapper.html('ODFs<select id=rec_id12 class="select2-container input-large form-control select2me" multiple=multiple style=width:100%> '),e.show(),setTimeout(function(){$("#rec_id12").select2({ajax:{url:"https://erp.herjimar.com/api/method/herjimar.herjimar.timesheet.getodfs",dataType:"json",processResults:function(e){return{results:e.message.results}}}}),$("#rec_id13").select2({ajax:{url:"https://erp.herjimar.com/api/method/herjimar.herjimar.timesheet.getincidencias",dataType:"json",processResults:function(e){return{results:e.message.results}}}})},500)}t.innerHTML=".atp-modal {z-index: 99999999;}.atp-time{display: none;}",document.head.appendChild(t),frappe.listview_settings.Timesheet={add_fields:["status","total_hours","start_date","end_date"],add_button:function(e,t,o,i){void 0===i&&(i=".page-actions");var n=document.createElement("button");n.classList.add("btn","btn-primary","btn-sm","primary-action"),n.innerHTML=e,n.onclick=o,document.querySelector(i).prepend(n)},onload:function(e){console.log(document.querySelector(".page-actions")),[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(function(e){return navigator.userAgent.match(e)})&&(document.querySelector(".primary-action").remove(),frappe.confirm("¿Desea añadir nuevos partes?",function(){o()},function(){})),this.add_button("+ Parte","default",function(){var e=new frappe.ui.Dialog({title:"Nuevo Parte",fields:[{label:"Fecha",fieldname:"fecha",fieldtype:"Date",reqd:1,onchange:function(t){null!=this.value&&0!=this.value.length?frappe.call({method:"GET",method:"herjimar.herjimar.timesheet.getreportado",args:{fecha:this.value},freeze:!0,callback:function(t){e.fields_dict.reportado.$wrapper.html("<B>"+t.message+"</B>")}}):e.fields_dict.reportado.$wrapper.html("")}},{label:"Reportado",fieldname:"reportado",fieldtype:"HTML"},{label:"Desde",fieldname:"desde",fieldtype:"HTML"},{label:"",fieldname:"tiempo",fieldtype:"HTML"},{fieldtype:"HTML",fieldname:"data_button"},{label:"Incidencia",fieldname:"incidencia",fieldtype:"HTML"},{label:"Hoja Verde",fieldname:"hv",id:"hvid",fieldtype:"HTML"},{label:"Actividad",fieldname:"actividad",fieldtype:"Link",options:"Activity Type",reqd:1},{label:"Terminado",fieldname:"terminado",fieldtype:"Check"},{label:"Reclamable",fieldname:"reclamable",fieldtype:"Check",onchange:function(t){e.fields_dict.reclamable.last_value?(e.fields_dict.incidencia.$wrapper.show(),e.fields_dict.data_button.$wrapper.hide()):(e.fields_dict.incidencia.$wrapper.hide(),e.fields_dict.data_button.$wrapper.show())}},{label:"Descripcion",fieldname:"descripcion",fieldtype:"Data"}],primary_action_label:"Guardar",primary_action:function(t){var o=0,i=document.getElementById("desdeh").value,n=document.getElementById("desdem").value,a=document.getElementById("hastah").value,l=document.getElementById("hastam").value,p=new Date(0,0,0,i,n,0);if((o=(new Date(0,0,0,a,l,0).getTime()-p.getTime())/1e3/60/60).toFixed(2)<0&&(o+=24),0==t.reclamable){if(null==$("#rec_id12").select2("val"))return void msgprint("Debe seleccionar al menos una ODF")}else if(null==$("#rec_id13").select2("val"))return void msgprint("Debe seleccionar al menos una incidencia");frappe.call({method:"GET",method:"herjimar.herjimar.timesheet.nuevoparte",args:{values:t,horas:o,odfs:$("#rec_id12").select2("val"),incidencias:$("#rec_id13").select2("val"),desde:document.getElementById("desdeh").value+":"+document.getElementById("desdem").value,hasta:document.getElementById("hastah").value+":"+document.getElementById("hastam").value},freeze:!0,callback:function(o){console.log(o);var i=new Date(t.fecha);frappe.confirm("Ya ha reportado "+o.message.horas+" horas para la fecha "+i.toLocaleDateString()+".¿Desea añadir mas partes?",function(){e.clear(),e.fields_dict.tiempo.$wrapper.html(""),e.fields_dict.hv.$wrapper.html(""),e.fields_dict.fecha.set_value(t.fecha),e.fields_dict.fecha.refresh(),document.getElementById("desdeh").value=document.getElementById("hastah").value,document.getElementById("desdem").value=document.getElementById("hastam").value,document.getElementById("hastah").value="0",document.getElementById("hastam").value="0",$("#rec_id12").val(null).trigger("change"),e.fields_dict.fecha.refresh()},function(){msgprint("Confirme el parte para continuar","Partes"),frappe.set_route("Form","Timesheet",o.message.parte)})}})}});e.fields_dict.incidencia.$wrapper.hide(),e.fields_dict.desde.$wrapper.html('\n    <div class="form-group"><div class="clearfix"><label class="control-label" style="padding-right: 0px;">Desde/Hasta</label></div>\n    <div class="control-input-wrapper">\t\t\t\t\t\t\n        <div class="control-input" style="display: block;">\n        \x3c!--<input type="text" name="desde" class="time mdl-textfield__input" id="desde" style="width: 48%; align: left;"/>--\x3e<select id="desdeh" "><option selected="selected" value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>:<select id="desdem" ><option selected="selected" value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select>\t\t\t----\x3e\x3c!--<input type="text" name="hasta" class="time mdl-textfield__input" id="hasta" style="width: 48%; align: right;"/>--\x3e<select id="hastah" ><option selected="selected" value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option></select>:<select id="hastam" ><option selected="selected" value="00">00</option><option value="05">05</option><option value="10">10</option><option value="15">15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option></select>\n        </div>\t\t\t\t\t\t\n        <div class="control-value like-disabled-input bold" style="display: none;"></div>\t\n        <p class="help-box small text-muted hidden-xs"></p>\t\n    </div></div>'),e.$wrapper.on("focus",function(){setTimeout(function(){var t=document.getElementById("desdeh").value,o=document.getElementById("desdem").value,i=document.getElementById("hastah").value,n=document.getElementById("hastam").value,a=new Date(0,0,0,t,o,0),l=(new Date(0,0,0,i,n,0).getTime()-a.getTime())/1e3/60/60;l.toFixed(2)<0&&(l+=24),e.fields_dict.tiempo.$wrapper.html("<B>"+l.toFixed(2)+" hora(s)</B>")},500)}),$("#rec_id12").remove(),e.fields_dict.incidencia.$wrapper.html('Incidencias<select id=rec_id13 class="select2-container input-large form-control select2me" multiple=multiple style=width:100%> '),e.fields_dict.data_button.$wrapper.html('ODFs<select id=rec_id12 class="select2-container input-large form-control select2me" multiple=multiple style=width:100%> '),e.show(),setTimeout(function(){$("#rec_id12").select2({ajax:{url:"https://erp.herjimar.com/api/method/herjimar.herjimar.timesheet.getodfs",dataType:"json",processResults:function(e){return{results:e.message.results}}}}),$("#rec_id13").select2({ajax:{url:"https://erp.herjimar.com/api/method/herjimar.herjimar.timesheet.getincidencias",dataType:"json",processResults:function(e){return{results:e.message.results}}}})},500)}),e.page.add_menu_item(__("Enviar Parte"),function(){o()}),frappe.call({method:"herjimar.herjimar.permisos.tiene_permiso",callback:function(t){t.message&&(console.log("lo tiene"),e.page.add_action_item("Enviar a XGEST",function(e){for(var t=[],o=0,i=e.view.cur_list.$checks;o<i.length;o+=1){var n=i[o];t.push(n.dataset.name)}console.log(t),frappe.call({method:"GET",method:"herjimar.herjimar.timesheet.enviarxgest",args:{partes:t},freeze:!0,callback:function(e){console.log(e.message);var t=new frappe.ui.Dialog({title:"Resumen Sincronización",fields:[{label:"respuesta",fieldname:"respuesta",fieldtype:"HTML"}]}),o="<tbody>";for(var i in e.message)o=o+"<tr style='background-color:"+(1==e.message[i].result?"green":"red")+";color:#ffffff;'><td>"+e.message[i].id+"</td><td>"+e.message[i].empleado+"</td><td>"+e.message[i].fecha+"</td><td>"+e.message[i].msg+"</td></tr>";t.fields_dict.respuesta.$wrapper.html("<table  class='table table-bordered' style='width: 100%;'><thead><tr><th>Parte</th><th>Empleado</th><th>Fecha</th><th>Mensaje</th></tr></thead>"+o+"</tbody></table>"),t.show()}})}))},args:{permiso:"Trasladar Partes a XGEST"},btn:$(".btn-primary"),freeze:!0,error:function(e){console.log("Error:"+e.message)}}),frappe.call({method:"herjimar.herjimar.permisos.tiene_permiso",callback:function(t){t.message&&(console.log("lo tiene"),e.page.add_menu_item(__("Mail Partes"),function(){var e=new frappe.ui.Dialog({title:"Opciones de envio",fields:[{label:"Fecha de los partes",fieldname:"fecha",fieldtype:"Date"},{label:"Jefe de Equipo",fieldname:"usuario",fieldtype:"Link",options:"Employee"},{label:"Con copia",fieldname:"copia",fieldtype:"Data"}],primary_action_label:"Enviar",primary_action:function(t){console.log(t),frappe.call({method:"herjimar.herjimar.partes.enviar_correo",callback:function(t){console.log("todo ok"),console.log(t.message),e.hide()},args:{fecha:t.fecha,jefe:t.usuario,copia:t.copia},btn:$(".btn-primary"),freeze:!0,error:function(e){console.log("Error:"+e.message)}})}});e.show()}))},args:{permiso:"System Manager"},btn:$(".btn-primary"),freeze:!0,error:function(e){console.log("Error:"+e.message)}})},get_indicator:function(e){return"Billed"==e.status?[__("Billed"),"green","status,=,Billed"]:"Payslip"==e.status?[__("Payslip"),"green","status,=,Payslip"]:"Completed"==e.status?[__("Completed"),"green","status,=,Completed"]:void 0}}}()}();
//# sourceMappingURL=timesheet_list.js.map
