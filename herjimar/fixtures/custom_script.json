[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Equipo",
  "modified": "2021-02-25 23:08:05.330994",
  "name": "Equipo-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Equipo', {\n\trefresh(frm) {\n\t\t// your code here\n\t\tconsole.log('test');\n\t\t//cur_frm.add_fetch('tipo_de_equipo','requiere_revisi\u00f3n','requiere_mantenimiento');\n\t\tif (!frm.is_new()) {\n            frm.add_custom_button('Realizar Mantenimiento', function() {\n                frappe.new_doc(\"Revision\", {\"equipo\":frm.doc.name,\"tipo\": \"VERIFICAR\"});\n                \n                }\n            );\n        }\n\t},\n\tsetup: function(frm) {\n\t\tfrm.set_query(\"tipo_de_equipo\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Tipo de Equipo\",\"clase\", \"=\", frm.doc.clase_de_equipo]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t}\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Asignacion Equipo",
  "modified": "2021-03-09 00:35:45.350685",
  "name": "Asignacion Equipo-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "\nfrappe.ui.form.on(\"refresh\", function(frm) {\n     frm.toggle_display(\"nuevo_responsable\", frm.doc.tipo==\"Asignaci\u00f3n de equipos\");\n});\n\nfrappe.ui.form.on('Asignacion Equipo', {\n    tipo: function(frm){\n         frm.toggle_display(\"nuevo_responsable\", frm.doc.tipo==\"Asignaci\u00f3n de equipos\");\n    },\n\ton_submit: function(frm){\n\t    console.log(\"Nombre:\"+frm.doc.name);\n\t\t// your code here\n\t\tfrappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.equipo.crear_posesion_masiva\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t},\n                args: {\n                    posesion:frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: true,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }\n\t\t\t});\n\t\t\t\n\t/*\tfor (var i = 0; i < cur_frm.doc.equipos.length; i++) {\n\t\t    console.log(\"alvado \"+cur_frm.doc.equipos[i].equipo);\n\t\t    if (frm.doc.tipo==\"Asignaci\u00f3n de equipos\"){\n\t\t        frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.equipo.crear_posesion\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t},\n                args: {\n                    equipo: cur_frm.doc.equipos[i].equipo,\n                    nuevo_responsable:cur_frm.doc.nuevo_responsable,\n                    fecha:cur_frm.doc.fecha,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: true,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }\n\t\t\t});\n\t\t    }else{\n\t\t        frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.equipo.eliminar_posesion\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t},\n                args: {\n                    equipo: cur_frm.doc.equipos[i].equipo,\n                    fecha:cur_frm.doc.fecha,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: true,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }\n\t\t\t});\n\t\t    }\n\t\t}*/\n\t}\n});\n\n\nfrappe.ui.form.on(\"Asignacion Equipo Individual\", {\n    // On qty update\n    equipo:function(frm, cdt, cdn){\n        var child = locals[cdt][cdn];\n\t    console.log(child.equipo);\n\t    \n\t    frappe.db.get_value('Equipo', child.equipo, 'responsable')\n        .then(r => {\n            console.log(r);\n            frappe.model.set_value(cdt, cdn, \"responsable_actual\", r.message.responsable);\n        });\n\n\t    frappe.db.get_value('Equipo', child.equipo, 'ubicaci\u00f3n')\n        .then(r => {\n            console.log(r);\n            frappe.model.set_value(cdt, cdn, \"ubicaci\u00f3n_actual\", r.message.ubicaci\u00f3n);\n        });\n\n\n    },\n    \n    \n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Revision",
  "modified": "2021-07-22 09:48:49.636671",
  "name": "Revision-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Revision', {\n\ton_submit(frm) {\n\t\tfrappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.revision.crear_hijo_equipo\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    \n\t\t\t\t},\n                args: {\n                    equipo: frm.doc.equipo,\n                    fecha:frm.doc.fecha,\n                    tipo:frm.doc.tipo,\n                    operario:frm.doc.operario,\n                    obs:frm.doc.observaciones,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: true,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }\n\t\t\t});\n\t},\n\tafter_cancel(frm) {\n\t\tfrappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.revision.cancelar\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t     console.log(\"callback:\"+r.message);\n\t\t\t\t},\n                args: {\n                    equipo: frm.doc.equipo,\n                    fecha:frm.doc.fecha,\n                    tipo:frm.doc.tipo,\n                    operario:frm.doc.operario,\n                    obs:frm.doc.observaciones,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: true,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }\n\t\t\t});\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Employee",
  "modified": "2023-04-20 22:50:50.462755",
  "name": "Employee-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Employee', {\n    validate: function(frm) {\n        var asigs=frm.doc.asignaci\u00f3n_lineas_de_negocio;\n        var total=0;\n        for (var i = 0; i < asigs.length; i++) { \n            total=total+asigs[i].porcentaje; \n        }\n        if (total!=100){\n            msgprint('Los porcentajes de asignaci\u00f3n a lineas de negocio debe sumar 100');\n            frappe.validated = false;\n        }\n    },\n    refresh(frm){\n        \n        var parent = $('.modified-by');\n        parent.remove();\n        var parent2 = $('.created-by');\n        parent2.remove();\n        var parent3 = $('.liked-by');\n        parent3.remove();\n        \n        if (!frm.is_new()) {\n            \n            frm.add_custom_button(__(\"Resumen Anual\"), function() {\n                var d = new frappe.ui.Dialog({\n\t\t\t\ttitle: 'Informe Licencias',\n\t\t\t\tprimary_action_label: 'Consultar',\n\t\t\t\tfields:[\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'A\u00f1o',\n\t\t\t\t\t\tfieldname: 'ejercicio',\n\t\t\t\t\t\tfieldtype: 'Int',\n\t\t\t\t\t\treqd: 1\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tprimary_action: function(values){\n\t\t\t\t    frappe.call({\n        \t\t\t\tmethod: \"herjimar.herjimar.vacaciones.resumen_excel\",\n        \t\t\t\tcallback: function(r) {\n        \t\t\t\t    console.log(\"todo ok\");\n        \t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t        d.hide();\n\t\t\t\t\t\t\twindow.open(\"https://erp.herjimar.com/files/\"+r.message,'_blank');\n                \t\t},\n                        args: {\n                            empleado:cur_frm.doc.name,\n                            ejercicio: values.ejercicio\n                        },\n                        // disable the button until the request is completed\n                        btn: $('.primary-action'),\n                        // freeze the screen until the request is completed\n                        freeze: false,\n                        error: (r) => {\n                            console.log(\"Error:\"+r.message);\n                        }}); \n\t\t\t\t}\n                });\n\t\t\t    d.show();\n            });\n            \n            frm.add_custom_button(__(\"Ver Licencias\"), function() {\n                var d = new frappe.ui.Dialog({\n\t\t\t\ttitle: 'Informe Licencias',\n\t\t\t\tprimary_action_label: 'Consultar',\n\t\t\t\tfields:[\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Desde',\n\t\t\t\t\t\tfieldname: 'desde',\n\t\t\t\t\t\tfieldtype: 'Date',\n\t\t\t\t\t\treqd: 1\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tlabel: 'Hasta',\n\t\t\t\t\t\tfieldname: 'hasta',\n\t\t\t\t\t\tfieldtype: 'Date',\n\t\t\t\t\t\treqd: 1\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tprimary_action: function(values){\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\tfrappe.call({\n        \t\t\t\tmethod: \"herjimar.herjimar.vacaciones.desglose\",\n        \t\t\t\tcallback: function(r) {\n        \t\t\t\t    console.log(\"todo ok\");\n        \t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t        d.hide();\n\t\t\t\t\t        var json=eval('('+r.message+')');\n\t\t\t\t\t        var t=new frappe.ui.Dialog({title:\"Resumen Licencias\",fields:[{label:\"respuesta\",fieldname:\"respuesta\",fieldtype:\"HTML\"}]});\n\t\t\t\t\t        var cabeza=\"<th>Fecha</th>\";\n\t\t\t\t\t        for(var i in json[\"tipos\"]){\n\t\t\t\t\t            cabeza+=\"<th>\"+json[\"tipos\"][i]+\"</th>\";\n\t\t\t\t\t        }\n\t\t\t\t\t            cabeza+=\"<th>Notas</th>\"\n\t\t\t\t\t        var cuerpo=\"\";\n\t\t\t\t\t        for(var i in json[\"registros\"]){\n\t\t\t\t\t            cuerpo+=\"<tr>\";\n\t\t\t\t\t            if (json[\"registros\"][i][\"doc_type\"]==\"Leave Application\"){\n\t\t\t\t\t                if (json[\"registros\"][i][\"desde\"]==json[\"registros\"][i][\"hasta\"]){\n\t\t\t\t\t                    cuerpo+=\"<td>\"+json[\"registros\"][i][\"desde\"]+\"</td>\";\n\t\t\t\t\t                }else{\n\t\t\t\t\t                    cuerpo+=\"<td>\"+json[\"registros\"][i][\"desde\"]+\"->\"+json[\"registros\"][i][\"hasta\"]+\"</td>\";\n\t\t\t\t\t                }\n\t\t\t\t\t            }else{\n\t\t\t\t\t                cuerpo+=\"<td>\"+json[\"registros\"][i][\"desde\"]+\"</td>\";\n\t\t\t\t\t            }\n    \t\t\t\t\t        for(var j in json[\"tipos\"]){\n    \t\t\t\t\t            if (json[\"tipos\"][j]==json[\"registros\"][i][\"tipo\"]){\n    \t\t\t\t\t                cuerpo+=\"<td>\"+json[\"registros\"][i][\"dias\"]+\"</td>\";\n    \t\t\t\t\t            }else{\n    \t\t\t\t\t                cuerpo+=\"<td></td>\";\n    \t\t\t\t\t            }\n    \t\t\t\t\t        }\n        \t\t\t            cuerpo+=\"<td>\"+json[\"registros\"][i][\"notas\"]+\"</td>\";\n\t\t\t\t\t            cuerpo+=\"</tr>\";\n\t\t\t\t\t        }\n\t\t\t\t\t        t.fields_dict.respuesta.$wrapper.html(\"<table  class='table table-bordered' style='width: 100%;'><thead><tr>\"+cabeza+\"</tr></thead><tbody>\"+cuerpo+\"</tbody></table>\"),t.show()\n\t\t\t\t\t        \n\t\t\t\t\t        \n                \t\t},\n                        args: {\n                            empleado:cur_frm.doc.name,\n                            desde: values.desde,\n                            hasta: values.hasta\n                        },\n                        // disable the button until the request is completed\n                        btn: $('.primary-action'),\n                        // freeze the screen until the request is completed\n                        freeze: false,\n                        error: (r) => {\n                            console.log(\"Error:\"+r.message);\n                        }});     \n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t});\n\t\t\td.show();\n        \n            });\n            \n            var parent = $('.form-dashboard');\n            parent.find('[data-testigo=\"tesvac\"]').remove();\n\n            parent.prepend('<div data-testigo=\"tesvac\" class=\"form-dashboard-section custom\">  <h5 style=\"margin-top: 20px;\"> Vacaciones Asignadas </h5> <table id=\"tvac\" class=\"table table-bordered small\"> <thead> <tr> <th style=\"width: 16%\">Tipo de Licencia</th> <th style=\"width: 16%\" class=\"text-right\">Licencias Asignadas</th> <th style=\"width: 16%\" class=\"text-right\">Arrastradas del a\u00f1o anterior</th><th style=\"width: 16%\" class=\"text-right\">Total de Licencias Asignadas</th> <th style=\"width: 16%\" class=\"text-right\">Licencias Usadas</th> <th style=\"width: 16%\" class=\"text-right\">Licencias en Borrador</th> <th style=\"width: 16%\" class=\"text-right\">Licencias Disponibles</th> </tr> </thead> <tbody>    </tbody> </table> </div>');\n            var today = new Date();\n            frappe.call({\n\t\t\t\t/*method: \"erpnext.hr.doctype.leave_application.leave_application.get_leave_details\",*/\n\t\t\t\tmethod: \"herjimar.herjimar.vacaciones.empleado_dashboard\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t\n\t\t\t\t\tlet myTable = document.getElementById('tvac').getElementsByTagName('tbody')[0];\n                    if (r.message.leave_allocation.Vacaciones){\n                    let row = myTable.insertRow();\n                    let cell1 = row.insertCell(0);\n                    let cell2 = row.insertCell(1);\n                    let cell3 = row.insertCell(2);\n                    let cell4 = row.insertCell(3);\n                    let cell5 = row.insertCell(4);\n                    let cell6 = row.insertCell(5);\n                    let cell7 = row.insertCell(6);\n                    \n                    cell1.innerHTML = \"Vacaciones\";\n                    cell2.innerHTML = r.message.leave_allocation.Vacaciones.total_leaves;\n                    cell3.innerHTML = r.message.leave_allocation.Vacaciones.expired_leaves;\n                    cell4.innerHTML = r.message.leave_allocation.Vacaciones.total_leaves2;\n                    cell5.innerHTML = r.message.leave_allocation.Vacaciones.leaves_taken;\n                    cell6.innerHTML = r.message.leave_allocation.Vacaciones.pending_leaves;\n                    cell7.innerHTML = r.message.leave_allocation.Vacaciones.remaining_leaves;\n\n                    cell2.className += \"text-right\";\n                    cell3.className += \"text-right\";\n                    cell4.className += \"text-right\";\n                    cell5.className += \"text-right\";\n                    cell6.className += \"text-right\";\n                    cell7.className += \"text-right\";\n                    }\n                    if (r.message.leave_allocation.TxT){\n                    let row = myTable.insertRow();\n                    let cell1 = row.insertCell(0);\n                    let cell2 = row.insertCell(1);\n                    let cell3 = row.insertCell(2);\n                    let cell4 = row.insertCell(3);\n                    let cell5 = row.insertCell(4);\n                    let cell6 = row.insertCell(5);\n                    let cell7 = row.insertCell(6);\n                    \n                    cell1.innerHTML = \"TxT\";\n                    cell2.innerHTML = r.message.leave_allocation.TxT.total_leaves;\n                    cell3.innerHTML = r.message.leave_allocation.TxT.expired_leaves;\n                    cell4.innerHTML = r.message.leave_allocation.TxT.total_leaves2;\n                    cell5.innerHTML = r.message.leave_allocation.TxT.leaves_taken;\n                    cell6.innerHTML = r.message.leave_allocation.TxT.pending_leaves;\n                    cell7.innerHTML = r.message.leave_allocation.TxT.remaining_leaves;\n\n                    cell2.className += \"text-right\";\n                    cell3.className += \"text-right\";\n                    cell4.className += \"text-right\";\n                    cell5.className += \"text-right\";\n                    cell6.className += \"text-right\";\n                    cell7.className += \"text-right\";\n                    }\n\n\t\t\t\t},\n                args: {\n                    employee:cur_frm.doc.name,\n                    date: today.toISOString().substring(0, 10)\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});            \n        }\n    },\n\tproyecto(frm) {\n\t    if (!frm.doc.proyecto){\n\t        // with options\n            frappe.msgprint({\n                title: __('Aviso'),\n                indicator: 'green',\n                message: __('Recuerde actualizar la linea de negocio en consecuencia')\n            });\n\t    }else{\n\t        frappe.db.get_doc('Project', frm.doc.proyecto)\n            .then(doc => {\n            var lista = [];\n\t        var item = {\n\t            idx: 0,\n\t\t\t    l\u00ednea_de_negocio : doc.l\u00ednea_de_negocio,\n\t\t\t    porcentaje: \"100\"\n\t\t    };\n\t\tlista.push(item);\n        \n\t        frm.set_value('asignaci\u00f3n_lineas_de_negocio', lista);\n\t    \n            })\n\t    }\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Incidencia",
  "modified": "2023-03-15 22:22:04.243993",
  "name": "Incidencia-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Incidencia', {\n    setup: function(frm) {\n\t\tfrm.set_query(\"hoja_verde_enlazada\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Hoja Verde\",\"terminado\", \"=\", 0]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\tfrm.set_query(\"proyecto\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Project\",\"status\", \"=\", \"Open\"]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t},\n    refresh: function (frm){\n         if (frm.doc.idx==0){\n             console.log(\"incidencia ni nueva ni duplicada\");\n         }else{\n             console.log(\"incidencia nueva o duplicada\");\n             frm.set_value('total_de_horas', 0);\n             frm.doc.total_de_horas = 0;\n         }\n        frm.toggle_reqd(\"departamento_causante\", ((frm.doc.reclamable_cliente == 0) && (frm.doc.reclamable_proveedor == 0)) );\n        console.log(\"pongo \"+((frm.doc.reclamable_cliente == 0) && (frm.doc.reclamable_proveedor == 0)) );\n        /*\n      frm.fields_dict['hoja_verde_enlazada'].get_query = function(doc) {\n    \treturn {\n    \t\tfilters: {\n    \t\t\t\"proyecto\": doc.proyecto\n    \t\t}\n    \t}\n    };\n      frm.fields_dict['odf'].get_query = function(doc) {\n    \treturn {\n    \t\tfilters: {\n    \t\t\t\"project\": doc.proyecto,\n    \t\t\t\"hoja_verde\": doc.hoja_verde_enlazada\n    \t\t}\n    \t}\n    };\n      frm.set_query(\"proyecto\", function() {\n          return {\n              filters:[\n            [\"Project\",\"status\",\"in\",[\"Open\"]]\n            ]\n          };\n      });*/\n  },\n    reclamable_cliente(frm){\n                frm.toggle_reqd(\"departamento_causante\", ((frm.doc.reclamable_cliente == 0) && (frm.doc.reclamable_proveedor == 0)) );\n    },\n    reclamable_proveedor(frm){\n                frm.toggle_reqd(\"departamento_causante\", ((frm.doc.reclamable_cliente == 0) && (frm.doc.reclamable_proveedor == 0)) );\n    },\n    validate: function (frm){\n      if ((frm.doc.reclamable_cliente==0)&&(frm.doc.reclamable_proveedor==0)&&(frm.doc.incidencia_interna==0)){\n            msgprint('Debe indicar Reclamable Cliente o Reclamable Proveedor o Interna');\n            frappe.validated=false;\n            return;\n      }\n      if ((frm.doc.reclamable_cliente==1)&&(frm.doc.incidencia_interna==1)){\n            msgprint('No puede ser Reclamable Cliente y Interna');\n            frappe.validated=false;\n            return;\n      }\n      if ((frm.doc.reclamable_proveedor==1)&&(frm.doc.incidencia_interna==1)){\n            msgprint('No puede ser Reclamable Proveedor y Interna');\n            frappe.validated=false;\n            return;\n      }\n      if ((frm.doc.reclamable_proveedor==1)&&(frm.doc.reclamable_cliente==1)){\n            msgprint('No puede ser Reclamable Proveedor y a cliente');\n            frappe.validated=false;\n            return;\n      }\n      frappe.db.get_value('Tipo de Incidencia',  frm.doc.tipo_de_incidencia, 'indicar_odf')\n        .then(r => {\n            if ((!frm.doc.odf)&&(r.message.indicar_odf>0)){\n                \n                \n                frappe.db.get_value('Project',  frm.doc.proyecto, 'l\u00ednea_de_negocio')\n                .then(r => {\n                    console.log(r.message.l\u00ednea_de_negocio);\n                    if (!r.message.l\u00ednea_de_negocio){\n                        msgprint('Debe indicar una linea de negocio para el proyecto asignado');\n                        frappe.validated=false;\n                    }else{\n                    if (r.message.l\u00ednea_de_negocio.startsWith(\"S-8\")){\n                        msgprint('Debe indicar una ODF');\n                        frappe.validated=false;\n                    }\n                    }\n                });\n                \n                \n                \n            }\n            if ((!frm.doc.hoja_verde_enlazada)&&(r.message.indicar_odf>0)){\n                msgprint('Debe indicar una Hoja Verde');\n                frappe.validated=false;\n            }\n        });\n \n  },\n  validatebackup: function(frm) {\n      console.log(\"validate\");\n     if((frm.doc.reclamable_cliente>0)||(frm.doc.reclamable_proveedor>0)){\n         console.log(\"debe rellenar datos\");\n         console.log(\"odf es >\"+frm.doc.odf+\"<\");\n         if (!frm.doc.odf){\n             console.log(\"odf esta vacio\");\n             \n         }else console.log(\"odf contiene algo\");\n        if (!frm.doc.hoja_verde_enlazada){\n             msgprint('Debe indicar una hoja verde');\n             frappe.validated=false;\n         }\n     }\n  },\n  hoja_verde_enlazada(frm){\n      if (frm.doc.hoja_verde_enlazada){\n          frappe.db.get_doc('Hoja Verde', frm.doc.hoja_verde_enlazada)\n            .then(doc => {\n                console.log(doc);\n                frm.set_value('proyecto', doc.proyecto);\n            })\n      }\n  },\n    proyecto(frm){\n         frappe.db.get_doc('Project', frm.doc.proyecto)\n            .then(doc => {\n                frm.set_value('nombre_del_proyecto', doc.project_name);\n            })\n    },\n  odf(frm) {\n\t    if (!frm.doc.odf){\n\t        // with options\n            frappe.msgprint({\n                title: __('Aviso'),\n                indicator: 'green',\n                message: __('Recuerde actualizar la hoja verde y el pedido en consecuencia')\n            });\n\t    }else{\n\t        console.log(\"hago consulta de \"+frm.doc.odf);\n\t        frappe.db.get_doc('Task', frm.doc.odf)\n            .then(doc => {\n                console.log(doc);\n                frm.set_value('proyecto', doc.project);\n                frappe.db.get_doc('Project', doc.project)\n                    .then(doc => {\n                        frm.set_value('nombre_del_proyecto', doc.project_name);\n                    });\n                frm.set_value('hoja_verde_enlazada', doc.hoja_verde);\n                frm.set_value('pedido', doc.pedido_cliente);\n                frm.set_value('agrupador', doc.agrupador);\n                frm.set_value('disciplina', doc.disciplina);\n                frm.set_value('unidad_constructiva', doc.unidad_constructiva);\n                frm.set_value('desc_op_grafo', doc.desc_op_grafo);\n        \n            })\n\t    }\n\t},\n\tcoste_de_la_maquinaria(frm) {\n\t\tcur_frm.set_value(\"total_coste_de_la_incidencia\", cur_frm.doc.coste_de_la_maquinaria + cur_frm.doc.coste_subcontrata + cur_frm.doc.total_coste_trabajadores + cur_frm.doc.coste_materiales);\n\t},\n\tcoste_subcontrata(frm) {\n\t\tcur_frm.set_value(\"total_coste_de_la_incidencia\", cur_frm.doc.coste_de_la_maquinaria + cur_frm.doc.coste_subcontrata + cur_frm.doc.total_coste_trabajadores + cur_frm.doc.coste_materiales);\n\t},\n\ttotal_coste_trabajadores(frm) {\n\t\tcur_frm.set_value(\"total_coste_de_la_incidencia\", cur_frm.doc.coste_de_la_maquinaria + cur_frm.doc.coste_subcontrata + cur_frm.doc.total_coste_trabajadores + cur_frm.doc.coste_materiales);\n\t},\n\tcoste_materiales(frm) {\n\t\tcur_frm.set_value(\"total_coste_de_la_incidencia\", cur_frm.doc.coste_de_la_maquinaria + cur_frm.doc.coste_subcontrata + cur_frm.doc.total_coste_trabajadores + cur_frm.doc.coste_materiales);\n\t},\n\t\n\timpacto_horas(frm) {\n\t    frappe.db.get_value('Project',  frm.doc.proyecto, 'coste_hora')\n        .then(r => {\n            frm.set_value('total_coste_trabajadores', frm.doc.n\u00famero_de_trabajadores*frm.doc.impacto_horas*r.message.coste_hora);\n        });\n\n\t//\tcur_frm.set_value(\"total_coste_trabajadores\", cur_frm.doc.coste_hora * cur_frm.doc.total_de_horas);\n\t},\n\testimaci\u00f3n_de_horas(frm){\n\t\tcur_frm.set_value(\"balance_horas\", cur_frm.doc.estimaci\u00f3n_de_horas -  cur_frm.doc.total_de_horas);\n\t},\n\tavance(frm){\n\t\tcur_frm.set_value(\"horas_proyectadas\", 100*cur_frm.doc.total_de_horas/cur_frm.doc.avance);\n\t\tcur_frm.set_value(\"balance_proyectado\", cur_frm.doc.estimaci\u00f3n_de_horas -  cur_frm.doc.horas_proyectadas);\n\t},\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Task",
  "modified": "2023-02-24 11:31:55.171826",
  "name": "Task-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Task', {\n        setup: function(frm) {\n\t\tfrm.set_query(\"hoja_verde\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Hoja Verde\",\"terminado\", \"=\", 0]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t\t\n\t},\n     notas_add:function(frm, cdt, cdn){\n        var child = locals[cdt][cdn];\n\t    console.log(\"Usuario:\"+frappe.session.user);\n     },\n\thoras_presupuestadas(frm){\n\t    frappe.db.get_doc('Project', frm.doc.project)\n            .then(doc => {\n                frm.set_value('coste_presupuestado', frm.doc.horas_presupuestadas*doc.coste_hora);\n        \n            })\n\t    \n\t},\n\thoja_verde(frm){\n         frappe.db.get_doc('Hoja Verde', frm.doc.hoja_verde)\n            .then(doc => {\n                frm.set_value('project', doc.proyecto);\n                frm.set_value('sector', doc.sector);\n                if ((frm.doc.orden_de_fabricacion==undefined)||(frm.doc.orden_de_fabricacion=='')){\n\t        console.log(\"ODF vacio\");\n\t        frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.task.get_nombre_odf\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\tfrm.doc.orden_de_fabricacion=r.message;\n\t\t\t\t\tfrm.toggle_display('orden_de_fabricacion',true);\n\t\t\t\t\tfrm.doc.sincronizar_xgest=1;\n\t\t\t\t},\n                args: {\n                    hoja_verde:frm.doc.hoja_verde,\n                    sector:frm.doc.sector,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n\t    }\n        \n            })\n    },\n\trefresh(frm) {\n\t    \n\t    \n\t    \n\t    if (!frm.is_new()) frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.task.get_enlaces\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t$(\"#zona_enlaces\").html(r.message);\n\t\t\t\t},\n                args: {\n                    tarea:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n        var parent = $('.form-attachments');\n        parent.prepend('<ul class=\"list-unstyled sidebar-menu\"><li class=\"h6 tags-label\">SharePoint</li><div id=\"zonasp\"><img src=\"https://erp.herjimar.com/files/loadinggif.gif\"/></div></ul>');\n         if (!frm.is_new()) frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.task.get_sharepoint\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t$(\"#zonasp\").html(r.message);\n\t\t\t\t},\n                args: {\n                    tarea:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n        \n        var parent = $('.form-dashboard-wrapper [data-doctype=\"Timesheet\"]').closest('div').parent();\n    \t\n    \tparent.find('[data-doctype=\"Componente\"]').remove();\n    \tparent.find('[data-doctype=\"NCC Cliente\"]').remove();\n\n    \tparent.append(' \\\n    \t<div class=\"document-link\" data-doctype=\"Componente\"> \\\n    \t<a class=\"badge-link small\">Componentes</a> \\\n    \t<span class=\"text-muted small count\"></span> \\\n    \t<span class=\"open-notification hidden\" title=\"Componentes\"></span> \\\n    \t\t<button class=\"btn btn-new btn-default btn-xs hidden\" data-doctype=\"Componente\"> \\\n    \t\t\t\t<i class=\"octicon octicon-plus\" style=\"font-size: 12px;\"></i> \\\n    \t\t</button>\\\n    \t</div>\\\n    \t<div class=\"document-link\" data-doctype=\"NCC Cliente\"> \\\n    \t<a class=\"badge-link small\">NCC Cliente</a> \\\n    \t<span class=\"text-muted small count\"></span> \\\n    \t<span class=\"open-notification hidden\" title=\"NCC Cliente\"></span> \\\n    \t\t<button class=\"btn btn-new btn-default btn-xs hidden\" data-doctype=\"NCC Cliente\"> \\\n    \t\t\t\t<i class=\"octicon octicon-plus\" style=\"font-size: 12px;\"></i> \\\n    \t\t</button>\\\n    \t</div>');\n    \tvar self = parent.find('[data-doctype=\"Componente\"]');\n    \t// bind links\n    \tself.find(\".badge-link\").on('click', function() {\n    \t\tfrappe.route_options = {\"odf\": frm.doc.name}\n    \t\tfrappe.set_route(\"List\", \"Componente\");\n    \t});\n    \t// bind open notifications\n    \tself.find('.open-notification').on('click', function() {\n    \t\tfrappe.route_options = {\n    \t\t\t\"odf\": frm.doc.name,\n    \t\t\t\"status\": \"Draft\"\n    \t\t}\n    \t\tfrappe.set_route(\"List\", \"Componente\");\n    \t});\n    \t// bind new\n    \tif(frappe.model.can_create(doctype)) {\n    \t\tself.find('.btn-new').removeClass('hidden');\n    \t}\n    \tself.find('.btn-new').on('click', function() {\n    \t\tfrappe.new_doc(\"Componente\",{\n    \t\t\t\"odf\": frm.doc.name\n    \t\t});\n    \t});\n    \tif (!frm.is_new()) set_open_count(frm, \"Componente\");\n        //segundo\n        var self2 = parent.find('[data-doctype=\"NCC Cliente\"]');\n    \t// bind links\n    \tself2.find(\".badge-link\").on('click', function() {\n    \t\tfrappe.route_options = {\"odf\": frm.doc.name}\n    \t\tfrappe.set_route(\"List\", \"NCC Cliente\");\n    \t});\n    \t// bind open notifications\n    \tself2.find('.open-notification').on('click', function() {\n    \t\tfrappe.route_options = {\n    \t\t\t\"odf\": frm.doc.name,\n    \t\t\t\"status\": \"Draft\"\n    \t\t}\n    \t\tfrappe.set_route(\"List\", \"NCC Cliente\");\n    \t});\n    \t// bind new\n    \tif(frappe.model.can_create(doctype)) {\n    \t\tself2.find('.btn-new').removeClass('hidden');\n    \t}\n    \tself2.find('.btn-new').on('click', function() {\n    \t\tfrappe.new_doc(\"NCC Cliente\",{\n    \t\t\t\"odf\": frm.doc.name\n    \t\t});\n    \t});\n    \tif (!frm.is_new()) set_open_count(frm, \"NCC Cliente\");\n\t\t\n\n\t}\n});\n\nfrappe.ui.form.on(\"TaskAnotacion\", {\n    // On qty update\n    refresh(frm) {\n        console.log(\"refresh hijo\");\n    },\n    anotaci\u00f3n:function(frm, cdt, cdn){\n        var child = locals[cdt][cdn];\n\t    console.log(\"child.equipo\");\n\t    child.usuario=frappe.session.user;\n\t    child.fecha=frappe.datetime.now_datetime();\n    }});\n    \n\nvar set_open_count = function (frm, doctype){\n    \t\n    \tvar method = '';\n    \tvar links = {};\n\n    \tif(doctype==\"Componente\"){\n    \t\tmethod = \"herjimar.herjimar.task.get_componentes\";\n    \t\tlinks = {\n    \t\t\t'fieldname': 'prevdoc_docname',\n    \t\t\t'transactions': [\n    \t\t\t\t{\n    \t\t\t\t\t'label': __('Componente'),\n    \t\t\t\t\t'items': ['Componente']\n    \t\t\t\t},\n    \t\t\t]\n    \t\t};\n    \t}\n    \tif(doctype==\"NCC Cliente\"){\n    \t\tmethod = \"herjimar.herjimar.task.get_ncc_cliente\";\n    \t\tlinks = {\n    \t\t\t'fieldname': 'prevdoc_docname',\n    \t\t\t'transactions': [\n    \t\t\t\t{\n    \t\t\t\t\t'label': __('NCC Cliente'),\n    \t\t\t\t\t'items': ['NCC Cliente']\n    \t\t\t\t},\n    \t\t\t]\n    \t\t};\n    \t}\n\n    \tif(method!=\"\"){\n    \t\tfrappe.call({\n    \t\t\ttype: \"GET\",\n    \t\t\tmethod: method,\n    \t\t\targs: {\n    \t\t\t\tdoctype: frm.doctype,\n    \t\t\t\tname: frm.doc.name,\n    \t\t\t\tlinks: links,\n    \t\t\t},\n    \t\t\tcallback: function(r) {\n    \t\t\t\t// update badges\n    \t\t\t\t$.each(r.message.count, function(i, d) {\n    \t\t\t\t\tfrm.dashboard.set_badge_count(d.name,  cint(d.count));\n    \t\t\t\t});\n    \t\t\t}\n    \t\t});\n    \t}\n    }\n\n    \n    "
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Componente",
  "modified": "2021-04-14 23:40:29.109023",
  "name": "Componente-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Componente', {\n\trefresh(frm) {\n\t\tfrm.dashboard.show();\n\t\tfrm.dashboard.add_transactions([\n\t\t{\n\t\t\t'label': 'My Label',\n\t\t\t'items': [\n\t\t\t\t'My Doctype 1',\n\t\t\t\t'My Doctype 2',\n\t\t\t\t'My Doctype 3'\n\t\t\t]\n\t\t}\n\t]);\n\t}\n})\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Formatos de Exportacion",
  "modified": "2021-06-25 12:16:25.730841",
  "name": "Formatos de Exportacion-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Formatos de Exportacion', {\n\tvalidate(frm) {\n\t\t// your code here\n\t\tif (frm.doc.fichero.endsWith(\".xlsx\")||frm.doc.fichero.endsWith(\".xls\")){\n\t\t    if (frm.doc.salida==\"Word\"){\n\t\t         msgprint(\"No es posible la conversi\u00f3n de Excel a Word\");\n\t        \tvalidated = false;\n\t\t    }\n\t\t}\n\t\tif (frm.doc.fichero.endsWith(\".docx\")||frm.doc.fichero.endsWith(\"..doc\")){\n\t\t    if (frm.doc.salida==\"Excel\"){\n\t\t         msgprint(\"No es posible la conversi\u00f3n de Word a Excel\");\n\t        \tvalidated = false;\n\t\t    }\n\t\t}\n\t\t\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Ordenes de Cambio",
  "modified": "2022-12-07 08:38:50.473981",
  "name": "Ordenes de Cambio-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Ordenes de Cambio', {\n    orden_de_fabricaci\u00f3n(frm){\n        frappe.db.get_value('Task',  frm.doc.orden_de_fabricaci\u00f3n, 'hoja_verde')\n        .then(r => {\n            frm.set_value('hoja_verde', r.message.hoja_verde);\n        });\n        frappe.db.get_value('Task',  frm.doc.orden_de_fabricaci\u00f3n, 'pedido_cliente')\n        .then(r => {\n            frm.set_value('pedido', r.message.pedido_cliente);\n        });\n    },\n    hoja_verde(frm){\n        frappe.db.get_value('Hoja Verde',  frm.doc.hoja_verde, 'proyecto')\n        .then(r => {\n            frm.set_value('proyecto', r.message.proyecto);\n        });\n    },\n    esfuerzo_estimado_h(frm){\n        frappe.db.get_value('Project',  frm.doc.proyecto, 'precio_hora_venta')\n        .then(r => {\n            frm.set_value('coste_estimado', frm.doc.esfuerzo_estimado_h*r.message.precio_hora_venta);\n        });\n    },\n    esfuerzo_real(frm){\n        frappe.db.get_value('Project',  frm.doc.proyecto, 'coste_hora')\n        .then(r => {\n            frm.set_value('coste_real', frm.doc.esfuerzo_real*r.message.coste_hora);\n        });\n    },\n    coste_real(frm){\n        frm.set_value('importe_final', frm.doc.coste_real+frm.doc.coste_de_materiales);\n//        frm.set_value('balance_frente_a_coste', frm.doc.importe_aceptado-frm.doc.importe_final);\n    },\n\tcoste_de_materiales(frm){\n        frm.set_value('importe_final', frm.doc.coste_real+frm.doc.coste_de_materiales);\n    },\n    horas_reclamadas(frm){\n        frappe.db.get_value('Project',  frm.doc.proyecto, 'precio_hora_venta')\n        .then(r => {\n            frm.set_value('importe_reclamado', frm.doc.horas_reclamadas*r.message.precio_hora_venta);\n        });\n    },\n    importe_final(frm){\n        frm.set_value('balance_frente_a_coste', frm.doc.importe_aceptado-frm.doc.importe_final);\n    },\n    importe_aceptado(frm){\n        frm.set_value('balance_frente_a_coste', frm.doc.importe_aceptado-frm.doc.importe_final);\n        frm.set_value('balance_frente_importe_reclamado', frm.doc.importe_aceptado-frm.doc.importe_reclamado);\n    },\n    importe_reclamado(frm){\n        frm.set_value('retorno_estimado', frm.doc.viabilidad_por_cien*frm.doc.importe_reclamado/100);\n        frm.set_value('balance_frente_importe_reclamado', frm.doc.importe_aceptado-frm.doc.importe_reclamado);\n    },\n    viabilidad_por_cien(frm){\n        frm.set_value('retorno_estimado', frm.doc.viabilidad_por_cien*frm.doc.importe_reclamado/100);\n    },\n\n\trefresh(frm) {\n\t    var parent = $('.form-attachments');\n        parent.prepend('<ul class=\"list-unstyled sidebar-menu\"><li class=\"h6 tags-label\">SharePoint</li><div id=\"zonasp\"><img src=\"https://erp.herjimar.com/files/loadinggif.gif\"/></div></ul>');\n         if (!frm.is_new()) frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.ordenes_de_cambio.get_sharepoint\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t$(\"#zonasp\").html(r.message);\n\t\t\t\t},\n                args: {\n                    oc:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n\t    \n\t    \n\t    \n\t\t\t    frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.ordenes_de_cambio.get_enlaces\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    \t$(\"#zona_incidencias\").html(r.message);\n\t\t\t\t},\n                args: {\n                    oc:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Leave Application",
  "modified": "2022-05-23 10:13:39.828715",
  "name": "Leave Application-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Leave Application', {\n\ttotal_leave_days(frm) {\n\t    console.log('voy');\n\t    console.log(frm.doc);\n\t\t                frm.set_value('dias_reales', frm.doc.total_leave_days);\n\t\tconsole.log('vengo');\n\t},\n\temployee(frm){\n\t     frappe.db.get_value('Employee',  frm.doc.employee, 'employee_number')\n                .then(r => {\n                    console.log(r.message.employee_number);\n                    frm.set_value('numero_empleado',r.message.employee_number);\n                    \n                    \n                });\n\t},\n\tleave_type(frm){\n\t    frm.set_query(\"subtipo\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Subtipo de licencia\",\"tipo_de_licencia\", \"=\", frm.doc.leave_type]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t},\n\tdias_reales(frm) {\n\t    console.log('voy');\n\t    console.log(frm.doc);\n\t\t                frm.set_value('total_leave_days', frm.doc.dias_reales);\n\t\tconsole.log('vengo');\n\t},\n\tsetup: function(frm) {\n\t\tfrm.set_query(\"leave_type\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Leave Type\",\"leave_type_name\", \"in\", [\"Baja remunerada\", \"Baja no remunerada\", \"Vacaciones\",\"TxT\"]]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t},\n\tvalidate: function(frm) {\n        if(frm.doc.leave_type!='Vacaciones' && frm.doc.leave_type!='Baja remunerada' && frm.doc.leave_type!='TxT' && frm.doc.leave_type!='Baja no remunerada') {\n            msgprint('Tipo de Licencia no valida');\n            validated = false;\n        }\n    } \n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Timesheet",
  "modified": "2023-01-24 22:26:05.793627",
  "name": "Timesheet-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Timesheet', {\n\temployee(frm) {\n\t    frappe.db.get_value('Employee',  frm.doc.employee, 'proyecto')\n        .then(r => {\n            frm.set_value('proyecto_empleado', r.message.proyecto);\n        });\n\t    frappe.db.get_value('Employee',  frm.doc.employee, 'tipo_recurso')\n        .then(r => {\n            frm.set_value('coste_directo_indirecto', r.message.tipo_recurso);\n        });\n        frm.set_value('title', frm.doc.employee);\n\t},\n\tsetup: function(frm) {\n\t    \t\tfrm.fields_dict['time_logs'].grid.get_field('incidencia').get_query = function(frm, cdt, cdn) {\n\t\t\tvar child = locals[cdt][cdn];\n\t\t\treturn{\n\t\t\t\tfilters: {\n\t\t\t\t\t'proyecto': child.project,\n\t\t\t\t\t\"estado\":[\"in\",['En curso','Registrado']]\n//\t\t\t\t\t\"estado\":[\"not in\",['Cerrado','Cancelado','Rechazado','Completado','Reclamado']]\n\t\t\t\t}\n\t\t\t};\n\t\t};\n    \t\t\n    \t}\n});\n\n\n\n\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Evaluacion del Desempeno",
  "modified": "2021-12-20 19:45:14.360949",
  "name": "Evaluacion del Desempeno-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Evaluacion del Desempeno', {\n\trefresh(frm) {\n\t\tconsole.log(\"cambiando\");\n\t\tvar parent = $('.title-text');\n\t\tparent.html(\"Evaluaci\u00f3n del desempe\u00f1o\");\n\t\tconsole.log(\"todo cambiado\");\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Hoja Verde",
  "modified": "2023-03-15 14:05:12.460090",
  "name": "Hoja Verde-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Hoja Verde', {\n     setup: function(frm) {\n         if (has_common(frappe.user_roles, [\"Puede modificar finalizaci\u00f3n Hojas verdes\"])){\n             console.log(\"lo tiene\");\n             frm.set_df_property(\"terminado\", \"read_only\", false);\n             frm.set_df_property(\"obra_facturada\", \"read_only\", false);\n         }else{\n             console.log(\"NO lo tiene\");\n            frm.set_df_property(\"terminado\", \"read_only\", true);\n             frm.set_df_property(\"obra_facturada\", \"read_only\", true);\n\n         }\n         \n     },\n    validate: function (frm){\n      if (frm.doc.oferta_previa==''){\n            msgprint('Debe indicar si dispone de oferta previa');\n            frappe.validated=false;\n            return;\n      }\n      if (frm.doc.obra_interna==0){\n            msgprint('Debe indicar si es una obra interna');\n            frappe.validated=false;\n            return;\n      }\n    },\n    refresh(frm){\n        frm.add_custom_button(__(\"Importar ODFs de XGEST\"), function() {\n            frappe.confirm(\n                'Va a importar las ODFs desde XGEST, \u00bfseguro?',\n                function(){\n                    frappe.call({\n                        method: 'herjimar.herjimar.hoja_verde.importar_odfs_xgest_js',\n                        args: {\n                            name: frm.doc.name\n                        },\n                        // disable the button until the request is completed\n                        btn: $('.primary-action'),\n                        // freeze the screen until the request is completed\n                        freeze: true,\n                        callback: (r) => {\n                            // on success\n                            console.log(r);\n                            frappe.msgprint({\n                                title: __('Importar ODFs'),\n                                indicator: 'green',\n                                message: __('ODFs importadas correctamente')\n                            });\n                            frm.refresh();\n                        },\n                        error: (r) => {\n                            console.log(r);\n                        }\n                    })\n\n                },\n                function(){\n                    show_alert('Acci\u00f3n cancelada.')\n                }\n            );   \n\n        });\n        frm.dashboard.show();\n        frm.dashboard.wrapper.show();\n       frm.dashboard.links_area.removeClass('hidden');\n\n        frm.dashboard.frm.fields[0].df.collapsible=1;\n        \n        \tvar pparent = $('.form-links');//.closest('div').parent();\n        \tvar parent = $('.transactions');//.closest('div').parent();\n        \tpparent.show();\n        \tparent.show();\nparent.find('[data-doctype=\"Task\"]').remove();\n\t\n\t\tparent.append(' \\\n    \t<div class=\"document-link\" data-doctype=\"Task\"> \\\n    \t<a class=\"badge-link small\">ODF / Tarea</a> \\\n    \t<span class=\"text-muted small count\"></span> \\\n    \t<span class=\"open-notification hidden\" title=\"Task\"></span> \\\n    \t\t<button class=\"btn btn-new btn-default btn-xs hidden\" data-doctype=\"Task\"> \\\n    \t\t\t\t<i class=\"octicon octicon-plus\" style=\"font-size: 12px;\"></i> \\\n    \t\t</button>\\\n    \t</div>\\\n    \t');\n    \t\n    \tvar self = parent.find('[data-doctype=\"Task\"]');\n    \t// bind links\n    \tself.find(\".badge-link\").on('click', function() {\n    \t\tfrappe.route_options = {\"hoja_verde\": frm.doc.name}\n    \t\tfrappe.set_route(\"List\", \"Task\");\n    \t});\n    \t// bind open notifications\n    \tself.find('.open-notification').on('click', function() {\n    \t\tfrappe.route_options = {\n    \t\t\t\"hoja_verde\": frm.doc.name\n    \t\t}\n    \t\tfrappe.set_route(\"List\", \"Task\");\n    \t});\n    \t// bind new\n    \tif(frappe.model.can_create(doctype)) {\n    \t\tself.find('.btn-new').removeClass('hidden');\n    \t}\n    \tself.find('.btn-new').on('click', function() {\n    \t\tfrappe.new_doc(\"Task\",{\n    \t\t\t\"proyecto\": frm.doc.name\n    \t\t});\n    \t});\n    \tif (!frm.is_new()) set_open_count(frm, \"Task\");\n    },\n    proyecto(frm){\n         frappe.db.get_doc('Project', frm.doc.proyecto)\n            .then(doc => {\n                if(frm.doc.obra_interna === undefined) frm.set_value('obra_interna', doc.obra_interna);\n                if(frm.doc.cliente === undefined) frm.set_value('cliente', doc.customer);\n                if(frm.doc.oferta_previa === undefined) frm.set_value('oferta_previa', doc.oferta_previa);\n                if(frm.doc.sector === undefined) frm.set_value('sector', doc.sector);\n                frm.set_value('nombre_del_proyecto', doc.project_name);\n                frm.set_value('responsable_proyecto', doc.responsable_del_proyecto);\n                frm.set_value('linea_de_negocio', doc.l\u00ednea_de_negocio);\n            })\n    },\n\tobra_interna(cur_frm) {\n\t\tif(cur_frm.doc.n\u00famero === undefined){\n\t\t   frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.task.get_proxima_hv\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcur_frm.set_value('n\u00famero', r.message);\n\t            \tcur_frm.refresh_field('n\u00famero');\n\t            \tconsole.log(r.message);\n\t\t\t\t},\n                args: {\n                    interna:cur_frm.doc.obra_interna,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                    msgprint(\"Error:\"+r.message);\n                }});\n\t\t}else{\n\t\t    //console.log('ya tiene numero');\n\t\t}\n\t},\n\timporte_horas_presupuesto(frm) {\n\t\tcur_frm.set_value(\"total_presupuesto\", cur_frm.doc.importe_horas_presupuesto + cur_frm.doc.materiales);\n\t},\n\tmateriales(frm) {\n\t\tcur_frm.set_value(\"total_presupuesto\", cur_frm.doc.importe_horas_presupuesto + cur_frm.doc.materiales);\n\t},\n\thoras_total_presupuesto(frm) {\n\t    frappe.db.get_value('Project',  frm.doc.proyecto, 'coste_hora')\n        .then(r => {\n            frm.set_value('importe_horas_presupuesto', frm.doc.horas_total_presupuesto*r.message.coste_hora);\n        });\n\t},\n\toferta_previa(cur_frm) {\n\t\tif(cur_frm.doc.presupuesto === undefined){\n\t\t   frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.task.get_proximo_presupuesto\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tcur_frm.set_value('presupuesto', r.message);\n\t            \tcur_frm.refresh_field('presupuesto');\n\t            \tconsole.log(r.message);\n\t\t\t\t},\n                args: {\n                    oferta_previa:cur_frm.doc.oferta_previa,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n\t\t}else{\n\t\t    //console.log('ya tiene numero');\n\t\t}\n\t},\t\n\t\n\t\n});\n\nvar set_open_count = function (frm, doctype){\n    \t\n    \tvar method = '';\n    \tvar links = {};\n    \t\n    \t\tmethod = \"herjimar.herjimar.hoja_verde.get_odfs\";\n    \t\tlinks = {\n    \t\t\t'fieldname': 'prevdoc_docname',\n    \t\t\t'transactions': [\n    \t\t\t\t{\n    \t\t\t\t\t'label': __('Task'),\n    \t\t\t\t\t'items': ['Task']\n    \t\t\t\t},\n    \t\t\t]\n    \t\t};\n    \t\n\n    \tif(method!=\"\"){\n    \t\tfrappe.call({\n    \t\t\ttype: \"GET\",\n    \t\t\tmethod: method,\n    \t\t\targs: {\n    \t\t\t\tdoctype: frm.doctype,\n    \t\t\t\tname: frm.doc.name,\n    \t\t\t\tlinks: links,\n    \t\t\t},\n    \t\t\tcallback: function(r) {\n    \t\t\t\t// update badges\n    \t\t\t\tconsole.log(r.message);\n    \t\t\t\t$.each(r.message.count, function(i, d) {\n    \t\t\t\t    console.log(d.name);\n    \t\t\t\t    console.log(d.count);\n    \t\t\t\t\tfrm.dashboard.set_badge_count(d.name,  cint(d.count));\n    \t\t\t\t});\n    \t\t\t}\n    \t\t});\n    \t}\n    }"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Project",
  "modified": "2022-06-06 14:01:17.313857",
  "name": "Project-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Project', {\n\trefresh(frm) {\n\t    \n\t    \n\t    var parent = $('.form-attachments');\n        parent.prepend('<ul class=\"list-unstyled sidebar-menu\"><li class=\"h6 tags-label\">SharePoint</li><div id=\"zonasp\"><img src=\"https://erp.herjimar.com/files/loadinggif.gif\"/></div></ul>');\n    \n          if (!frm.is_new()) {\n              \n              frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.project.get_sharepoint\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t$(\"#zonasp\").html(r.message);\n\t\t\t\t},\n                args: {\n                    proyecto:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n          }\n    \n\t    frm.add_custom_button(__(\"Importar ODFs de XGEST\"), function() {\n            frappe.confirm(\n                'Va a importar las ODFs desde XGEST, \u00bfseguro?',\n                function(){\n                    frappe.call({\n                        method: 'herjimar.herjimar.project.importar_odfs_xgest_js',\n                        args: {\n                            name: frm.doc.name\n                        },\n                        // disable the button until the request is completed\n                        btn: $('.primary-action'),\n                        // freeze the screen until the request is completed\n                        freeze: true,\n                        callback: (r) => {\n                            // on success\n                            console.log(r);\n                            frappe.msgprint({\n                                title: __('Importar ODFs'),\n                                indicator: 'green',\n                                message: __('ODFs importadas correctamente')\n                            });\n                            frm.refresh();\n                        },\n                        error: (r) => {\n                            console.log(r);\n                        }\n                    })\n\n                },\n                function(){\n                    show_alert('Acci\u00f3n cancelada.')\n                }\n            );   \n\n        });\n\t\tvar parent = $('.form-dashboard-wrapper [data-doctype=\"Task\"]').closest('div').parent();\n\t\tparent.find('[data-doctype=\"Hoja Verde\"]').remove();\n\t\tparent.append(' \\\n    \t<div class=\"document-link\" data-doctype=\"Hoja Verde\"> \\\n    \t<a class=\"badge-link small\">Hoja Verde</a> \\\n    \t<span class=\"text-muted small count\"></span> \\\n    \t<span class=\"open-notification hidden\" title=\"Hoja Verde\"></span> \\\n    \t\t<button class=\"btn btn-new btn-default btn-xs hidden\" data-doctype=\"Hoja Verde\"> \\\n    \t\t\t\t<i class=\"octicon octicon-plus\" style=\"font-size: 12px;\"></i> \\\n    \t\t</button>\\\n    \t</div>\\\n    \t');\n    \t\n    \tvar self = parent.find('[data-doctype=\"Hoja Verde\"]');\n    \t// bind links\n    \tself.find(\".badge-link\").on('click', function() {\n    \t\tfrappe.route_options = {\"proyecto\": frm.doc.name}\n    \t\tfrappe.set_route(\"List\", \"Hoja Verde\");\n    \t});\n    \t// bind open notifications\n    \tself.find('.open-notification').on('click', function() {\n    \t\tfrappe.route_options = {\n    \t\t\t\"proyecto\": frm.doc.name\n    \t\t}\n    \t\tfrappe.set_route(\"List\", \"Hoja Verde\");\n    \t});\n    \t// bind new\n    \tif(frappe.model.can_create(doctype)) {\n    \t\tself.find('.btn-new').removeClass('hidden');\n    \t}\n    \tself.find('.btn-new').on('click', function() {\n    \t\tfrappe.new_doc(\"Hoja Verde\",{\n    \t\t\t\"proyecto\": frm.doc.name\n    \t\t});\n    \t});\n    \tif (!frm.is_new()) set_open_count(frm, \"Hoja Verde\");\n\t}\n});\n\nvar set_open_count = function (frm, doctype){\n    \t\n    \tvar method = '';\n    \tvar links = {};\n    \t\n    \t\tmethod = \"herjimar.herjimar.project.get_hojas_verdes\";\n    \t\tlinks = {\n    \t\t\t'fieldname': 'prevdoc_docname',\n    \t\t\t'transactions': [\n    \t\t\t\t{\n    \t\t\t\t\t'label': __('Hoja Verde'),\n    \t\t\t\t\t'items': ['Hoja Verde']\n    \t\t\t\t},\n    \t\t\t]\n    \t\t};\n    \t\n\n    \tif(method!=\"\"){\n    \t\tfrappe.call({\n    \t\t\ttype: \"GET\",\n    \t\t\tmethod: method,\n    \t\t\targs: {\n    \t\t\t\tdoctype: frm.doctype,\n    \t\t\t\tname: frm.doc.name,\n    \t\t\t\tlinks: links,\n    \t\t\t},\n    \t\t\tcallback: function(r) {\n    \t\t\t\t// update badges\n    \t\t\t\tconsole.log(r.message);\n    \t\t\t\t$.each(r.message.count, function(i, d) {\n    \t\t\t\t    console.log(d.name);\n    \t\t\t\t    console.log(d.count);\n    \t\t\t\t\tfrm.dashboard.set_badge_count(d.name,  cint(d.count));\n    \t\t\t\t});\n    \t\t\t}\n    \t\t});\n    \t}\n    }"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Quotation",
  "modified": "2022-06-02 13:09:27.138466",
  "name": "Quotation-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "/*\n\nfrappe.ui.form.on('Quotation', {\n    onload: function(frm) {\n        if (frm.doc.docstatus==0) {\n            frm.set_value('electrodos', 0.06);\n            frm.set_value('oxigeno_y_varios', 0.03);\n        }  \n    },\n    electrodos:function(frm){\n\t    frm.set_value('importe_electrodos', frm.doc.electrodos*frm.doc.total_kgs);\n\t},\n\tgalvanizados:function(frm){\n\t    frm.set_value('importe_galvanizados', frm.doc.galvanizados*frm.doc.total_kgs);\n\t},\n\toxigeno_y_varios:function(frm){\n\t    frm.set_value('importe_oxigeno_y_varios', frm.doc.oxigeno_y_varios*frm.doc.total_kgs);\n\t},\n\tpintura:function(frm){\n\t    frm.set_value('importe_pintura', frm.doc.pintura*frm.doc.total_m2);\n\t},\n\thoras_mano_obra:function(frm){\n\t    frm.set_value('total_mano_de_obra', frm.doc.horas_mano_obra*frm.doc.importe_mano_obra);\n\t},\n\timporte_mano_obra:function(frm){\n\t    frm.set_value('total_mano_de_obra', frm.doc.horas_mano_obra*frm.doc.importe_mano_obra);\n\t},\n\ttotal_m2:function(frm){\n\t    frm.set_value('importe_pintura', frm.doc.pintura*frm.doc.total_m2);\n\t},\n\ttotal_kgs:function(frm){\n\t    frm.set_value('importe_electrodos', frm.doc.electrodos*frm.doc.total_kgs);\n\t    frm.set_value('importe_galvanizados', frm.doc.galvanizados*frm.doc.total_kgs);\n\t    frm.set_value('importe_oxigeno_y_varios', frm.doc.oxigeno_y_varios*frm.doc.total_kgs);\n\t},\n\ttotal_materiales:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_materiales', frm.doc.beneficio_materiales*frm.doc.total_materiales/100);\n\t},\n\timporte_electrodos:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\timporte_galvanizados:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\timporte_oxigeno_y_varios:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\ttrasporte:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\tgruas:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\ttotal_mano_de_obra:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_mano_de_obra', frm.doc.beneficio_mano_de_obra*frm.doc.total_mano_de_obra/100);\n\t},\n\timporte_pintura:function(frm){\n\t    frm.set_value('suma_total', frm.doc.total_materiales+frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas+frm.doc.total_mano_de_obra);\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\tbeneficio_materiales:function(frm){\n\t    frm.set_value('importe_beneficio_materiales', frm.doc.beneficio_materiales*frm.doc.total_materiales/100);\n\t},\n\tbeneficio_mano_de_obra:function(frm){\n\t    frm.set_value('importe_beneficio_mano_de_obra', frm.doc.beneficio_mano_de_obra*frm.doc.total_mano_de_obra/100);\n\t},\n\tbeneficio_varios:function(frm){\n\t    frm.set_value('importe_beneficio_varios', frm.doc.beneficio_varios*(frm.doc.importe_electrodos+frm.doc.importe_galvanizados+frm.doc.importe_oxigeno_y_varios+frm.doc.importe_pintura+frm.doc.trasporte+frm.doc.gruas)/100);\n\t},\n\tsuma_total:function(frm){\n\t    frm.set_value('importe_total',frm.doc.importe_beneficio_materiales+frm.doc.importe_beneficio_mano_de_obra+frm.doc.importe_beneficio_varios+frm.doc.suma_total);\n\t},\n\timporte_beneficio_varios:function(frm){\n\t    frm.set_value('importe_total',frm.doc.importe_beneficio_materiales+frm.doc.importe_beneficio_mano_de_obra+frm.doc.importe_beneficio_varios+frm.doc.suma_total);\n\t},\n\timporte_beneficio_materiales:function(frm){\n\t    frm.set_value('importe_total',frm.doc.importe_beneficio_materiales+frm.doc.importe_beneficio_mano_de_obra+frm.doc.importe_beneficio_varios+frm.doc.suma_total);\n\t},\n\timporte_beneficio_mano_de_obra:function(frm){\n\t    frm.set_value('importe_total',frm.doc.importe_beneficio_materiales+frm.doc.importe_beneficio_mano_de_obra+frm.doc.importe_beneficio_varios+frm.doc.suma_total);\n\t},\n\timporte_total:function(frm){\n\t    frm.set_value('total',frm.doc.importe_total*frm.doc.numero_unidades);\n\t},\n\tnumero_unidades:function(frm){\n\t    frm.set_value('total',frm.doc.importe_total*frm.doc.numero_unidades);\n\t    frm.set_value('total_qty',frm.doc.numero_unidades);\n\t},\n\tbefore_save:function(frm){\n\t    frm.set_value('total',frm.doc.importe_total*frm.doc.numero_unidades);\n\t},\n});\n\nfrappe.ui.form.on('Quotation Item', {\n\tunidades:function(frm, cdt, cdn){\n\t\tactualizaLongitud(frm, cdt, cdn);\n\t\tactualizaPesoTotal(frm, cdt, cdn);\n\t\tactualizaUnidades(frm, cdt, cdn);\n\t},\n\tlongitud:function(frm, cdt, cdn){\n\t\tactualizaPeso(frm, cdt, cdn);\n\t\tactualizaLongitud(frm, cdt, cdn);\n\t},\n\tancho:function(frm, cdt, cdn){\n\t\tactualizaPeso(frm, cdt, cdn);\n\t\tactualizaRendimiento(frm, cdt, cdn);\n\t},\n\tespesor:function(frm, cdt, cdn){\n\t\tactualizaPeso(frm, cdt, cdn);\n\t},\n\tpeso_por_metro:function(frm, cdt, cdn){\n\t\tactualizaPeso(frm, cdt, cdn);\n\t\tactualizaPesoTotal(frm, cdt, cdn);\n\t},\n\tpeso_por_kilogramo:function(frm, cdt, cdn){\n\t\tactualizaPesoTotal(frm, cdt, cdn);\n\t},\n\trendimiento:function(frm, cdt, cdn){\n\t\tactualizaSuperficie(frm, cdt, cdn);\n\t},\n\tlongitud_total:function(frm, cdt, cdn){\n\t\tactualizaSuperficie(frm, cdt, cdn);\n\t\tactualizaPesoTotal(frm, cdt, cdn);\n\t},\n\tsuperficie_total:function(frm, cdt, cdn){\n\t    var total = 0;\n        $.each(frm.doc.items || [], function(i, d) {\n            total += flt(d.superficie_total);\n        });\n        frm.set_value('total_m2', total);\n\t},\n\trate:function(frm, cdt, cdn){\n\t    var total = 0;\n        $.each(frm.doc.items || [], function(i, d) {\n            if(d.name==cdn){\n                total += (d.rate*d.qty);\n            }else total += d.amount;\n        });\n        frm.set_value('total_materiales', total);\n\t},\n\tqty:function(frm, cdt, cdn){\n\t    var total = 0;\n        $.each(frm.doc.items || [], function(i, d) {\n            if(d.name==cdn){\n                total += (d.rate*d.qty);\n            }else total += d.amount;\n        });\n        frm.set_value('total_materiales', total);\n\t},\n\tpeso_total:function(frm, cdt, cdn){\n\t\tactualizaUnidades(frm, cdt, cdn);\n\t    var total = 0;\n        $.each(frm.doc.items || [], function(i, d) {\n            total += flt(d.peso_total);\n        });\n        frm.set_value('total_kgs', total);\n\t},\n});\n\n\n\n\nfunction actualizaPeso(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\n\tif ((child.peso_por_metro==0)||(child.peso_por_metro==undefined)){\n\t    frappe.model.set_value(cdt, cdn, \"peso_por_kilogramo\", child.longitud*child.ancho*child.espesor*8);\n\t}else{\n\t    frappe.model.set_value(cdt, cdn, \"peso_por_kilogramo\", child.longitud*child.peso_por_metro);\n\t}\n}\n\nfunction actualizaRendimiento(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\n\tif ((child.ancho==0)||(child.ancho==undefined)){\n\t    frappe.model.set_value(cdt, cdn, \"rendimiento\",0);\n\t}else{\n\t    frappe.model.set_value(cdt, cdn, \"rendimiento\",child.ancho*2);\n\t}\n}\n\nfunction actualizaLongitud(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\t    frappe.model.set_value(cdt, cdn, \"longitud_total\",child.longitud*child.unidades);\n}\n\nfunction actualizaSuperficie(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\t    frappe.model.set_value(cdt, cdn, \"superficie_total\",child.longitud_total*child.rendimiento);\n}\n\nfunction actualizaPesoTotal(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\tif ((child.peso_por_metro==0)||(child.peso_por_metro==undefined)){\n\t    frappe.model.set_value(cdt, cdn, \"peso_total\",child.peso_por_kilogramo*child.unidades);\n\t}else{\n\t    frappe.model.set_value(cdt, cdn, \"peso_total\",child.peso_por_metro*child.longitud_total);\n\t}\n}\n\nfunction actualizaUnidades(frm, cdt, cdn){\n    var child = locals[cdt][cdn];\n\tif ((child.peso_total==0)||(child.peso_total==undefined)){\n\t    frappe.model.set_value(cdt, cdn, \"qty\",child.unidades);\n\t}else{\n\t    frappe.model.set_value(cdt, cdn, \"qty\",child.peso_total);\n\t}\n\tvar total = 0;\n        $.each(frm.doc.items || [], function(i, d) {\n            total += flt(d.qty);\n        });\n        frm.set_value('total_qty', total);\n}\n\n*/\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Subtipo de licencia",
  "modified": "2022-05-23 10:02:20.541339",
  "name": "Subtipo de licencia-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Subtipo de licencia', {\n\tsetup: function(frm) {\n\t\tfrm.set_query(\"tipo_de_licencia\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: [\n\t\t\t\t\t[\"Leave Type\",\"leave_type_name\", \"in\", [\"Baja remunerada\", \"Baja no remunerada\", \"Vacaciones\",\"TxT\"]]\n\t\t\t\t]\n\t\t\t}\n\t\t});\n\t}\n});"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Riesgo",
  "modified": "2022-09-14 20:19:03.013578",
  "name": "Riesgo-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Riesgo', {\n\tcategoria: function(frm) {\n            poner_subcategorias(frm);\n    }\n});\n\nvar poner_subcategorias = function (frm)\n{\n\tif(frm.doc.categoria == \"T\u00e9cnicos\")\n\t{\n\t\tfrm.set_df_property(\"subcategoria\", \"options\", [\"Calidad\",\"Complejidad e Interfaces\",\"Desempe\u00f1o y fiabilidad\",\"Requisitos\",\"Tecnolog\u00eda\"]);\n\t}\n\telse if(frm.doc.categoria == \"Organizaci\u00f3n\")\n\t{\n\t\tfrm.set_df_property(\"subcategoria\", \"options\", [\"Dependencias del proyecto\",\"Financiamiento\",\"Priorizaci\u00f3n\",\"Recursos\"]);\n\t}\n\telse if(frm.doc.categoria == \"Direcci\u00f3n de Proyectos\")\n\t{\n\t\tfrm.set_df_property(\"subcategoria\", \"options\", [\"Comunicaci\u00f3n\",\"Control\",\"Estimaci\u00f3n\",\"Planificaci\u00f3n\"]);\n\t}\n\telse if(frm.doc.categoria == \"Externos\")\n\t{\n\t\tfrm.set_df_property(\"subcategoria\", \"options\", [\"Cliente\",\"Clima\",\"Mercado\",\"Normativa\",\"Subcontratistas y proveedores\"]);\n\t}\n\t\n}"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Equipamiento",
  "modified": "2023-01-23 08:49:43.977802",
  "name": "Equipamiento-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Equipamiento', {\n\trefresh(frm) {\n\t\tvar parent = $('.form-attachments');\n        parent.prepend('<ul class=\"list-unstyled sidebar-menu\"><li class=\"h6 tags-label\">SharePoint</li><div id=\"zonasp\"><img src=\"https://erp.herjimar.com/files/loadinggif.gif\"/></div></ul>');\n         if (!frm.is_new()) frappe.call({\n\t\t\t\tmethod: \"herjimar.herjimar.equipamiento.get_sharepoint\",\n\t\t\t\tcallback: function(r) {\n\t\t\t\t    console.log(\"todo ok\");\n\t\t\t\t\tconsole.log(r.message);\n\t\t\t\t\t$(\"#zonasp\").html(r.message);\n\t\t\t\t},\n                args: {\n                    oc:cur_frm.doc.name,\n                },\n                // disable the button until the request is completed\n                btn: $('.primary-action'),\n                // freeze the screen until the request is completed\n                freeze: false,\n                error: (r) => {\n                    console.log(\"Error:\"+r.message);\n                }});\n\t}\n})"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Issue",
  "modified": "2023-02-09 12:32:24.718680",
  "name": "Issue-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Issue', {\n\tissue_type(frm) {\n\t    frappe.db.get_value('Issue Type',  frm.doc.issue_type, 'usuario_responsable')\n        .then(r => {\n            frm.set_value('responsable', r.message.usuario_responsable);\n        });\n\t},\n})"
 }
]